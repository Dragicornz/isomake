<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Create ISO from Files</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    input[type="file"] { margin-bottom: 20px; }
    button { padding: 10px 20px; font-size: 16px; }
    progress { width: 100%; height: 20px; margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Create ISO from Files</h1>
  <input type="file" id="fileInput" multiple>
  <br>
  <button onclick="createISO()">Create ISO</button>
  <progress id="progress" value="0" max="100" style="display:none;"></progress>
  
  <script>
    async function createISO() {
      const files = document.getElementById('fileInput').files;
      if (files.length === 0) {
        alert('Please select some files.');
        return;
      }

      const progress = document.getElementById('progress');
      progress.style.display = 'block';
      progress.value = 0;

      const fileEntries = [];
      const encoder = new TextEncoder();

      // Prepare each file
      for (let file of files) {
        const content = await file.arrayBuffer();
        fileEntries.push({
          name: file.name,
          size: file.size,
          content: new Uint8Array(content)
        });
      }

      const sectorSize = 2048;
      let isoParts = [];

      // Create a simple ISO header
      const volumeDescriptor = new Uint8Array(sectorSize);
      volumeDescriptor.set(encoder.encode('CD001'), 1);
      volumeDescriptor[0] = 1; // Primary Volume Descriptor
      volumeDescriptor[6] = 1; // Version
      isoParts.push(volumeDescriptor);

      let currentSector = 20; // Start after system reserved sectors
      let directoryRecords = [];

      for (let entry of fileEntries) {
        const sectorsNeeded = Math.ceil(entry.size / sectorSize);
        const paddedContent = new Uint8Array(sectorsNeeded * sectorSize);
        paddedContent.set(entry.content);
        isoParts.push(paddedContent);

        directoryRecords.push({
          name: entry.name,
          extent: currentSector,
          size: entry.size
        });

        currentSector += sectorsNeeded;
      }

      // Make a simple directory structure
      const pathTable = new Uint8Array(sectorSize);
      isoParts.push(pathTable);

      // Volume Descriptor Terminator
      const terminator = new Uint8Array(sectorSize);
      terminator[0] = 255; // Volume Descriptor Set Terminator
      terminator.set(encoder.encode('CD001'), 1);
      terminator[6] = 1;
      isoParts.push(terminator);

      progress.value = 80;

      // Merge all parts
      let totalLength = isoParts.reduce((sum, part) => sum + part.length, 0);
      const isoBlob = new Blob(isoParts, { type: 'application/octet-stream' });

      progress.value = 100;

      const url = URL.createObjectURL(isoBlob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'output.iso';
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
